<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

	<!-- Css-->
	<link rel="stylesheet" type="text/css" href="css/headerstyle.css">
	<link rel="stylesheet" type="text/css" href="css/menustyle.css">
	<link rel="stylesheet" type="text/css" href="css/tablestyle.css">
	<!-- Backbone, Underscore , Jquery dependancies -->
	
	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
   <script type="text/javascript" src="js/jquery.json-2.2.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.4.3/underscore-min.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.3.1/jquery.cookie.js"></script>
	
	
		
	<script type="text/javascript">
	
	$(function(){
	
		var UserCredentials = Backbone.Model.extend({
			
			defaults:{
				'username':'',
				'password':''
			}
			
		});
		
		var ResponseModel = Backbone.Model.extend({
			
		});	
		
		
		Backbone.View.prototype.close = function(){
			alert("calling backbones prototype");
			this.undelegateEvents();
	  		this.$el.removeData().unbind();
	  		this.remove();
	  		Backbone.View.prototype.remove.call(this);
		};
		
		var User = Backbone.Model.extend({
			methodToURL: {
			   // 'read': '/user/get',
			   // 'create': '/user/create',
			   // 'update': 'http://localhost:8081/transactionjersey/rest/payment/updatePerson',
			    //'delete': '/user/remove'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
			  },

			  sync: function(method, model, options) {
			    options = options || {};
			    options.url = model.methodToURL[method.toLowerCase()];
				console.log(method.toLowerCase);
			    return Backbone.sync.apply(this, arguments);
			  }
		});
		
		var UserCollection = Backbone.Collection.extend({
			
					
			
			methodToURL: {
				    'read': 'http://10.10.10.55:5000/get_users',
				   // 'create': '/user/create',
				   // 'update': 'http://localhost:8081/transactionjersey/rest/payment/updatePerson',
				   'delete': 'http://10.10.10.55:5000/delete_user'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
				  },
			sync: function(method, model, options) {
					    options = options || {};
					    options.url = model.methodToURL[method.toLowerCase()];
						console.log(method.toLowerCase);
					    return Backbone.sync.apply(this, arguments);
			},
			
			parse:function(response){
				//console.log(response);
				console.log(response);
				
				return response.users;
			}
			
		
		});
		
		var UserModel = Backbone.Model.extend({
			defaults:{
				'username':'default'
			}
			
		});
		
		var IndexView = Backbone.View.extend({
	   
			template : _.template($("#header").html()),
			
			initialize : function(){
			},
			
										
			events:{
				
			},
			
			render: function(){
				data = obj.username;
				
				this.model.set('username',data);
				
				console.log(this.model.get('username'));
				
				this.$el.html(this.template());
				if(role=='User')
				{
					var adminview = new AdminView();
					adminview.render().el;
				}else{
					var userview = new UserView();
					userview.render().el;
				}
	        	return this;
			}
		});
		
		var AdminView = Backbone.View.extend({
			
			el:"#menu", 
				
			template:_.template($("#menuscript").html()),
			
			events:{
				'click #listuser':'listuser',
				'click #updateuser':'updateuser',
				'click #updaterole':'updaterole',
				'click #adduser':'adduser'
			},
		
			adduser:function(){
				var adduserview = new AddUserCredentialView();
				
				
			},
			
			listuser:function(){
				
				var coll = new UserCollection();
				var listuserview = new ListUserView({collection:coll});
			},
			
			updateuser:function(){
				$("#content").html("hi u clicked updateuser");
			},
			
			updaterole:function(){
				$("#content").html("hi u clicked update role");
			},
			
			deleteuser:function(){
				$("#content").html("hi u clicked delete user");
			},
			
			initialize:function(){
				_.bindAll(this); 
				
		    },
			
			
			render:function(){
				$("#menu").html(this.template);	
				return this;
			}
			
		});
		
		var AddUserCredentialView = Backbone.View.extend({
			
			el:"#content",
			
			template:_.template($("#addusercredentialTemplate").html()),
			
			events:{
				'click #submitButton':'submit'
			},
			
			submit:function(){
				alert("submit clicked");
			},
					
			initialize:function(){
				this.render();
			},
			
			render:function(){
				this.$el.html(this.template());
				
			}
		
		});
		
		
		var UserView = Backbone.View.extend({
			
		});
		
		var ListUserView = Backbone.View.extend({
			
			tagName:"table",
			
			initialize:function(){
				var that =  this;
								
				this.collection.fetch({
					error: function () {
    	 	         
    	 	    		},
    	 	      	 success: function () {
    	 	      		console.log(that.collection);
    	 	      		 alert(that.collection.toJSON());
    	 	           		
    	 	    		}
    	 	    	}).complete(function () {
    	 	    		  that.render();        	
      		        }, this)
				
			},
			
			
			render:function(){
				
				$(this.el).attr('id', 'id1').addClass('bordered'); 
				
				console.log(this.collection.models);
				
				var that = this;
						
				this.$el.append("<th>ID</th><th>FIRSTNAME</th><th>LASTNAME</th><th>ROLE</th><th colspan='2'>ACTION</th>");
					
				this.collection.each(function(mod) {
					var userview = new UserView({model:mod});
  		        	$("#content").html(that.$el.append(userview.render().el));
  		           	
  		        }, this)
		        return this;
				
			},
			
			
			
		});
		
		var UserView = Backbone.View.extend({
			tagName:'tr',
			
			template: _.template( $('#userTemplate').html() ),
			
			events:{
				'click tr':'deleteuser'
			},
			
			deleteuser:function(){
				alert("user deleting");
			},
					
			render:function(){
				$(this.el).attr('id', this.model.id);
				this.$el.append(this.template(this.model.toJSON()));
				return this;
			}
					
			
		});
		
				
		var Router = Backbone.Router.extend({
	    	vied : null,
			routes: {
	        	'': 'index',
	        	'admin':'adminview'
	        },
	      
	    	index: function(){
	    		alert("in index");
	    		var usermodel = new UserModel();
	    		var indexview = new IndexView({model:usermodel});
	    		$(document.body).append(indexview.render().el);
	    		//$("#mainContent").css("background-color",obj.color);
	    	},
	    	
	    	adminview:function(){
	    		
	    		
	    	},
	    	
	    	addUser:function(){
	    		var personmodel = new Person();
	    		var adduserview = new AddUserView({model:personmodel});
	    		$('#mainContent').html(adduserview.render().el);
	    	},
	    	
		    hello:function(){
		    	//console.log("rendered view is "+this.vied);
		    	var peopleView = new PeopleView ({collection: peopleCollection});
	    		console.log(peopleView);
	    		$('#mainContent').html(peopleView.render().el);
	   	   	},
	    
	   	   	how: function(){
	   	   		console.log("rendered view is "+this.vied);	
	    		var newview = new NewView ();
	    		vied = newview;
	    		$('#mainContent').html(newview.render().el);
	    	}
	    });
		
			if ($.cookie("data")!=null)
			var datacookie = $.cookie("data");
			//var userdata = $.toJSON(datacookie);
			
			console.log(datacookie)
			
			var obj = $.parseJSON(datacookie);
					
			console.log(obj);
			var role = obj.role;
			var color = obj.color;
			var username = obj.username;

		   	new Router();
		    Backbone.history.start();
		
	});
	
	</script>

	</head>
	
	<body>

	<script type="text/template" id="header">
		<div id="blackBar">
			
		</div>
	</script>
		
	<div id="mainContent">
		<div id="menu">
		</div>
		<div id="content">
		</div>
		
	</div>

	<script type="text/template" id="menuscript">
			<div id='cssmenu'>
				<ul>
				<li id='listuser'><a><span>ListUser</span></a>
				</li>
				<li id='adduser'><a><span>AddUser</span></a>
				</li>
				<li class='has-sub' id='updateuser'><a><span>Update User</span></a>
					<ul><li class='last' ><a id='updaterole'><span>Update Role</span></a></li>
						<li class='last'><a><span>Update UserName</span></a></li>
					</ul>
				</li>
				<li class='last'><a ><span>Delete User</span></a></li></ul></div>
	</script>
	
	<script type="text/template" id="userTemplate">
				<td><%=this.model.get('id')%></td>
				<td><%=this.model.get('firstname')%></td>
				<td><%=this.model.get('lastname')%></td>
				<td><%=this.model.get('role')%></td>
				<td><input type='button' id='update' value='UPDATE'></td>
				<td><input type='button' id='delete' value='DELETE'></td>
	</script>
	
	<script type="text/template" id="addusercredentialTemplate">
			<div id='user'>
				
					<fieldset>
  						<legend>Credentials</legend>
    						<label for="name">Username:</label>
    						<input type="text" name="name" id="username" />
    						<br />
    						<label for="password">Password:</label>
    						<input type="password" name="pass" id="password"  />
    						<br />
    						<button type="submit" class="buttonclass" name="submit" id="submitButton" >Add Credentials</button>
  					</fieldset>
				
			</div>	
		
	</script>
	
	
	</body>
	
	</html>