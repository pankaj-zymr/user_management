<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

	<!-- Css-->
	<link rel="stylesheet" type="text/css" href="css/headerstyle.css">
	<link rel="stylesheet" type="text/css" href="css/menustyle.css">
	<!-- Backbone, Underscore , Jquery dependancies -->
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.4.3/underscore-min.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
	
	
		
	<script type="text/javascript">
	
	$(function(){
	
		Backbone.View.prototype.close = function(){
			alert("calling backbones prototype");
			this.undelegateEvents();
	  		this.$el.removeData().unbind();
	  		this.remove();
	  		Backbone.View.prototype.remove.call(this);
		};
		
		var User = Backbone.Model.extend({
			methodToURL: {
			   // 'read': '/user/get',
			   // 'create': '/user/create',
			   // 'update': 'http://localhost:8081/transactionjersey/rest/payment/updatePerson',
			    //'delete': '/user/remove'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
			  },

			  sync: function(method, model, options) {
			    options = options || {};
			    options.url = model.methodToURL[method.toLowerCase()];
				console.log(method.toLowerCase);
			    return Backbone.sync.apply(this, arguments);
			  }
		});
		
		var UserCollection = Backbone.Collection.extend({
			model:User,
			url:'http://10.10.10.55:5000/get_users',
			
			parse:function(response){
				console.log(response.status);
			}
			
		});
		
		var IndexView = Backbone.View.extend({
	   
			template : _.template($("#header").html()),
			
			initialize : function(){
				 this.render();
			},
		
			events:{
			},
			render: function(){
				this.$el.html(this.template());
	        	var adminview = new AdminView();
	        	adminview.render().el;
				return this;
			}
		});
		
		var AdminView = Backbone.View.extend({
			
			el:"#mainContent", 
				
			template:_.template($("#menuscript").html()),
			
			events:{
				'click #listuser':'listuser'
			},
		
			initialize:function(){
				_.bindAll(this); 
				var users = new UserCollection();
				users.fetch({
					error: function () {
	    	 	         
	    	 	    		},
	    	 	       success: function () {
	    	 	           
	    	 	    	}
	    	 	    }).complete(function () {
	    	 	    	console.log(users.models);
	    	 	    });
		    },
			
			
			render:function(){
				$("#menu").html(this.template);	
				return this;
			}
			
		});
				
		var Router = Backbone.Router.extend({
	    	vied : null,
			routes: {
	        	'': 'index',
	        	'admin':'adminview'
	        },
	      
	    	index: function(){
	    		alert("in index");
	    		var indexview = new IndexView();
	    		$(document.body).append(indexview.render().el);
	    	},
	    	
	    	adminview:function(){
	    		$("#content").html("hi");
	    		
	    	},
	    	
	    	addUser:function(){
	    		var personmodel = new Person();
	    		var adduserview = new AddUserView({model:personmodel});
	    		$('#mainContent').html(adduserview.render().el);
	    	},
	    	
		    hello:function(){
		    	//console.log("rendered view is "+this.vied);
		    	var peopleView = new PeopleView ({collection: peopleCollection});
	    		console.log(peopleView);
	    		$('#mainContent').html(peopleView.render().el);
	   	   	},
	    
	   	   	how: function(){
	   	   		console.log("rendered view is "+this.vied);	
	    		var newview = new NewView ();
	    		vied = newview;
	    		$('#mainContent').html(newview.render().el);
	    	}
	    });

		   	new Router();
		    Backbone.history.start();
		
	});
	
	</script>

	</head>
	
	<body>

	<script type="text/template" id="header">
		<div id="blackBar">
		</div>
	</script>
		
	<div id="mainContent">
		<div id="menu">
		</div>
		<div id="content">
		</div>
		
	</div>

	<script type="text/template" id="menuscript">
			<div id='cssmenu'>
				<ul>
				<li id='listuser'><a><span>ListUser</span></a>
				</li>
				<li class='has-sub'><a><span>Update User</span></a>
					<ul><li class='last'><a><span>Update Role</span></a></li>
						<li class='last'><a><span>Update UserName</span></a></li>
					</ul>
				</li>
				<li class='last'><a ><span>Delete User</span></a></li></ul></div>
	</script>
	
	
	
	</body>
	
	</html>