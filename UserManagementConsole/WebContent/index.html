<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

	<!-- Css-->
	<link rel="stylesheet" type="text/css" href="css/headerstyle.css">
	
	<!-- Backbone, Underscore , Jquery dependancies -->
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.4.3/underscore-min.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
	
	
		
	<script type="text/javascript">
	
	$(function(){
	
		Backbone.View.prototype.close = function(){
			alert("calling backbones prototype");
			this.undelegateEvents();
	  		this.$el.removeData().unbind();
	  		this.remove();
	  		Backbone.View.prototype.remove.call(this);
		};
		
		var globaluser;
		
		var User = Backbone.Model.extend({
			
		});
		
		var Credentials = Backbone.Model.extend({
			url:'http://10.10.10.55:5000/login',
			
			defaults:{
				'username':'admin',
				'password':'admin'
			},
			parse:function(response){
				return response;
			}
		});
				
		
		var IndexView = Backbone.View.extend({
	   
			template : _.template($("#header").html()),
			
			initialize : function(){
				 this.render();
			},
		
			events:{
			},
				
			render: function(){
				var credentials = new Credentials();
				this.$el.html(this.template());
				var loginview = new LoginView({model:credentials});
				$("#content").html(loginview.render().el);
	          return this;
	          
	    	}
		});
		
		var LoginView = Backbone.View.extend({
			
			template : _.template($("#loginTemplate").html()),
					
			events:{
				'click #loginbuttonid':'submit',
			},
			
			submit:function(){
				alert("hello");
				var userName = $("#username").val();
				var passWord = $("#password").val();
				this.model.set({'password':passWord,'username':userName});
				alert(this.model.get('username'));
				this.save();
			},
			
			save:function(){
				this.model.save(null, {
				    success: function (model, response) {
				    	
				    	
				    	if(globaluser.get('username')=='admin'){
				    		var route = new Router();
			 				route.navigate('admin',{trigger:true,replace: true});
				    	}
				    },
				    error: function (model, response) {
				    	alert("invalid credentials");
				        console.log("Error login user");
				    }
				});
			},
			
			render:function(){
				alert("in loginview");
				this.$el.append(this.template());
				return this;
			},
			
		});
		
		var AdminView = Backbone.View.extend({
			
			render:function(){
				$("#menu").append("<ul><li>ListUser</li><li>AddUser</li><li>UpdateUser</li>");	
				//$("#content").append("hi");
				return this;
			},
		});
		
		
		var PeopleView = Backbone.View.extend({
	    	
			events:{
				'click #hello':'hello'
			},
		
			hello : function(){
				alert("button clicked");
				this.close();
				var route = new Router();
				route.navigate('how',{trigger:true});
			},
			
	    	render: function(){
	        	this.collection.each(function(person) {
	        		var personView = new PersonView({ model: person });
	            	this.$el.append(personView.render().el);
	        	}, this)
	        	this.$el.append("<input type='button' id='hello' value='hello'></input>");
	    	    return this;
	    	}
		});

		var PersonView = Backbone.View.extend({
	    	tagName: 'li',

	    	template: _.template("<%=first%><%=age%><%=last%>"),

	    	events:{
	    		"click a":"clicked"
	    	},
	    
	    	render: function(){
	    		this.$el.append(this.template(this.model.toJSON()) );
	        	return this;
	    	},
	    
		});

	
		var AddUserView = Backbone.View.extend({
			
			template:_.template("FIRSTNAME :<input type='text' id='first'></input><br> LASTNAME : <input type='text' id='last'></input><br> AGE: <input type='text' id='age'></input><br> <input type='button' id='adde' value='ADD'>"),
			
			events:{
				'click #adde':'add',
			},
			
			add:function(){
				this.model.set({first:$('#first').val()});
				this.model.set({last:$('#last').val()});
				this.model.set({age:$('#age').val()});
				console.log(this.model.toJSON());
				this.model.save();
			},
			render:function(){
				this.$el.html(this.template);
				return this;
			}
			
		});
		
		
		
		var Router = Backbone.Router.extend({
	    	vied : null,
			routes: {
	        	'': 'index',
	        	'admin':'adminview'
	        },
	      
	    	index: function(){
	    		var indexview = new IndexView();
	    		console.log(indexview);
	    		$(document.body).append(indexview.render().el);
	    	},
	    	
	    	adminview:function(){
	    		$("#content").html("hi");
	    		
	    	},
	    	
	    	addUser:function(){
	    		var personmodel = new Person();
	    		var adduserview = new AddUserView({model:personmodel});
	    		$('#mainContent').html(adduserview.render().el);
	    	},
	    	
		    hello:function(){
		    	//console.log("rendered view is "+this.vied);
		    	var peopleView = new PeopleView ({collection: peopleCollection});
	    		console.log(peopleView);
	    		$('#mainContent').html(peopleView.render().el);
	   	   	},
	    
	   	   	how: function(){
	   	   		console.log("rendered view is "+this.vied);	
	    		var newview = new NewView ();
	    		vied = newview;
	    		$('#mainContent').html(newview.render().el);
	    	}
	    });

		   	new Router();
		    Backbone.history.start();
		
	});
	
	</script>

	</head>
	
	<body>

	<script type="text/template" id="header">
		<div id="blackBar">
		</div>
	</script>
		
	<div id="mainContent">
		<div id="menu">
		</div>
		<div id="content">
		</div>
		
	</div>

	
	<!-- Template for login -->
		<script type="text/template" id="loginTemplate">
				<div id='login'>
				<form>
					<fieldset>
  						<legend>Please Login</legend>
    						<label for="name">Username:</label>
    						<input type="text" name="name" id="username" />
    						<br />
    						<label for="password">Password:</label>
    						<input type="password" name="pass" id="password" />
    						<br />
    						<input type="button" class='buttonclass' value="Login" id="loginbuttonid" />
  					</fieldset>
				</form>
				</div>
		</script>
	
	</body>
	
	</html>